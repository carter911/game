<!DOCTYPE html>

<html class="no-js">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title></title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.12.0/theme-chalk/index.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.12.0/index.js"></script>
    <link rel="stylesheet" href="/static/lib/index.css" />
    <script src="/static/lib/avue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.bootcss.com/qs/6.5.1/qs.min.js"></script>
    <script src="https://cdn.bootcss.com/FileSaver.js/2014-11-29/FileSaver.min.js"></script>
    <script src="https://cdn.bootcss.com/xlsx/0.14.1/xlsx.full.min.js"></script>
</head>

<body>
<div id="app">
    <div class="block">
        <el-card style="height: 100%">
            <avue-crud @row-save="handleRowSave"
                       @row-update="handleRowUpdate"
                       :option="option"
                       :page="page"
                       :data="data"
                       @search-change="searchChange"
                       @size-change="sizeChange"
                       @current-change="currentChange">
                <template slot="searchMenu">
                </template>
            </avue-crud>
        </el-card>

    </div>
</div>
</body>
<script>

    new Vue({
        el: '#app',
        data() {
            return {
                indexUrl :'/index/index/get_list',
                updateUrl :'/index/index/store',
                saveUrl :'/index/index/store',
                deleteUrl :'/index/index/delete',

                search:{},
                page: {
                    pageSize: 10,
                    currentPage:1,
                },
                data:[],
                option:{
                }
            }
        },
        created() {
            this.getList();

        },
        methods: {
            currentDate: function(){
                let d = new Date()
                return d.format('yyyy-MM-dd')
            },
            searchChange(params,done) {
                this.page.currentPage = 1;
                this.search = params;
                this.getList();
                done();
            },
            getList() {
                var that = this;
                let params={
                    search:this.search,
                    page:this.page,
                };
                axios.get(this.indexUrl,{params:params}).then(res=>{
                    console.log(res);
                    if(res.data.code == 200){
                        that.page = res.data.data.page;
                        that.option = res.data.data.option;
                        that.data = res.data.data.data;
                    }
                }).catch(err=>{
                    alert('系统加载异常 请稍后重试')
                    console.log(err);
                })
            },
            handleRowSave(row,done,loading){
                console.log(row,done,loading)
            },
            handleRowUpdate(row,index,done,loading){
                console.log(row,index,done,loading)
            },
            sizeChange(val){
                this.page.currentPage = 1;
                this.page.pageSize = val;
                this.getList()
            },
            currentChange(val) {
                this.page.currentPage = val;
                this.getList();
                this.$message.success('页码' + val)
            }
        }
    })
</script>

</html>
